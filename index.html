<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ورود / ثبت نام | هاویرکشت</title>
<link href="output.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
@font-face {
    font-family: 'vazir';
    src: url('../fonts/vazir.woff2') format('woff2');
}
body { font-family: 'vazir', sans-serif; }
</style>
</head>

<body class="h-screen overflow-hidden">

<div class="relative w-full h-full bg-[linear-gradient(rgba(0,0,0,0.85),rgba(0,0,0,0.5)),url('/background.jpg')] bg-cover bg-center flex items-center justify-center">

    <div class="relative w-[380px] h-[520px] bg-white p-1 rounded-2xl shadow-2xl overflow-hidden">

        <!-- Toggle Buttons -->
        <div class="relative w-[220px] my-9 mx-auto rounded-[30px] shadow-[0_0_20px_9px_#ff61241f] flex">
            <div id="btn" class="absolute top-0 right-0 w-[110px] h-full bg-gradient-to-r from-[#13ab05] to-[#80ff72] rounded-[30px] transition-all duration-500"></div>
            <button type="button" class="relative w-[110px] py-2.5 z-10" onclick="login()">ورود</button>
            <button type="button" class="relative w-[110px] py-2.5 z-10" onclick="register()">ثبت نام</button>
        </div>

        <!-- Title -->
        <div class="text-center text-lg font-bold text-gray-700 -mt-4 mb-2">
            سامانه هاویر کشت
        </div>

        <div id="message" class="text-center text-sm text-red-500"></div>

        <!-- Login Form -->
        <form id="login" class="absolute top-[200px] right-0 w-full px-8 transition-all duration-500 flex flex-col space-y-5">

            <input name="username" id="username" type="text"
            placeholder="نام کاربری یا ایمیل" required
            class="w-full px-4 py-3 rounded-full bg-gray-100 focus:bg-white border border-transparent focus:border-green-400 focus:ring-2 focus:ring-green-300 outline-none transition">

            <input name="password" id="password" type="password"
            placeholder="رمز عبور" required
            class="w-full px-4 py-3 rounded-full bg-gray-100 focus:bg-white border border-transparent focus:border-green-400 focus:ring-2 focus:ring-green-300 outline-none transition">

            <button type="submit"
            class="w-[85%] mx-auto py-2.5 bg-gradient-to-r from-[#13ab05] to-[#80ff72] text-black rounded-[30px]">
            ورود
            </button>

        </form>

        <!-- Register Form -->
        <form id="register" class="absolute top-[200px] right-[450px] w-full px-8 transition-all duration-500 flex flex-col space-y-5">

            <input type="text" placeholder="نام کاربری"
            class="w-full px-4 py-3 rounded-full bg-gray-100 focus:bg-white border border-transparent focus:border-green-400 focus:ring-2 focus:ring-green-300 outline-none transition">

            <input type="email" placeholder="ایمیل"
            class="w-full px-4 py-3 rounded-full bg-gray-100 focus:bg-white border border-transparent focus:border-green-400 focus:ring-2 focus:ring-green-300 outline-none transition">

            <input type="password" placeholder="رمز عبور"
            class="w-full px-4 py-3 rounded-full bg-gray-100 focus:bg-white border border-transparent focus:border-green-400 focus:ring-2 focus:ring-green-300 outline-none transition">

            <button
            class="w-[85%] mx-auto py-2.5 bg-gradient-to-r from-[#13ab05] to-[#80ff72] text-black rounded-[30px]">
            ثبت نام
            </button>

        </form>

    </div>
</div>



<script>
const API = "https://edu-api.havirkesht.ir";
const loginForm = document.getElementById("login");
const message = document.getElementById("message");

loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    if(password.length < 8){
        alert("رمز عبور باید حداقل 8 کاراکتر باشد");
        return;
    }

    const formData = new URLSearchParams();
    formData.append("username", username);
    formData.append("password", password);

    try{
        const response = await fetch(`${API}/token`,{
            method:"POST",
            headers:{
                "Content-Type":"application/x-www-form-urlencoded"
            },
            body:formData
        });



        const data = await response.json();

        if(response.ok){
            localStorage.setItem("access_token", data.access_token);
            localStorage.setItem("token_type", data.token_type);

            message.style.color="green";
            message.innerText="ورود موفق!";

            setTimeout(()=>{
                window.location.href="dashboord.html";
            },1000);
        }else{
            message.innerText = data.detail || "نام کاربری یا رمز اشتباه";
        }

    }catch(error){
        message.innerText="عدم اتصال به سرور";
    }
});

// Animation Functions
var x = document.getElementById("login");
var y = document.getElementById("register");
var z = document.getElementById("btn");

function register(){
    x.style.right = "-400px";
    y.style.right = "0px";
    z.style.right = "110px";
}

function login(){
    x.style.right = "0px";
    y.style.right = "450px";
    z.style.right = "0";
}
</script>

</body>
</html>
